<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Merrick Trade City â€” Admin Panel</title>
  <style>
    :root{--bg:#0a1025;--accent:#7c5cff}
    body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:#fff;display:flex;min-height:100vh}
    .sidebar{width:220px;background:linear-gradient(180deg,#7c5cff,#0f0c29);padding:18px;display:flex;flex-direction:column;gap:12px}
    .sidebar h2{margin:0;text-align:center}
    .sidebar button{background:none;border:none;color:#fff;padding:8px;text-align:left;cursor:pointer;border-radius:6px}
    .main{flex:1;padding:18px;display:flex;flex-direction:column;gap:14px}
    .summary{display:flex;gap:14px}
    .card{background:rgba(255,255,255,0.04);padding:12px;border-radius:10px;flex:1}
    .charts{display:flex;gap:14px;flex-wrap:wrap}
    canvas{background:transparent;border-radius:8px}
    .top-right{display:flex;gap:8px;align-items:center}
    .btn{padding:8px 10px;border-radius:8px;border:none;cursor:pointer}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#ddd}
    .btn-primary{background:linear-gradient(90deg,#7c5cff,#ff6b6b);color:#fff}
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>Merrick Admin</h2>
    <button data-section="dashboard" id="navDashboard">Dashboard</button>
    <button data-section="bots" id="navBots">Bots</button>
    <button data-section="transactions" id="navTx">Transactions</button>
    <button data-section="settings" id="navSettings">Settings</button>
    <div style="margin-top:auto">
      <button id="logoutBtn" class="btn btn-ghost">Logout</button>
    </div>
  </div>

  <div class="main">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h1 style="margin:0;font-size:1.3rem">Admin Dashboard</h1>
      <div class="top-right">
        <div id="adminEmailDisplay" style="opacity:0.9"></div>
      </div>
    </div>

    <div id="dashboardSection">
      <div class="summary">
        <div class="card"><h3>Total Users</h3><p id="totalUsers">12</p></div>
        <div class="card"><h3>Total Bots</h3><p id="totalBots">8</p></div>
        <div class="card"><h3>Total Balance</h3><p id="totalBalance">Ksh 24,500</p></div>
      </div>

      <div class="charts">
        <div class="card" style="flex:1;min-width:300px">
          <h4>Bot Categories</h4>
          <canvas id="botCategoryChart" width="400" height="220"></canvas>
        </div>
        <div class="card" style="flex:1;min-width:300px">
          <h4>Transactions (Ksh)</h4>
          <canvas id="transactionsChart" width="400" height="220"></canvas>
        </div>
      </div>
    </div>

    <div id="botsSection" style="display:none">
      <div class="card">
        <h3>Upload Bot</h3>
        <form id="botForm" class="form" style="display:flex;gap:8px;flex-wrap:wrap">
          <input id="botName" placeholder="Bot name" style="padding:8px;border-radius:6px;border:none;background:rgba(255,255,255,0.03);color:#fff">
          <input id="botCategory" placeholder="Category" style="padding:8px;border-radius:6px;border:none;background:rgba(255,255,255,0.03);color:#fff">
          <input id="botPrice" type="number" placeholder="Price (Ksh)" style="padding:8px;border-radius:6px;border:none;background:rgba(255,255,255,0.03);color:#fff">
          <button type="button" id="uploadBotBtn" class="btn btn-primary">Upload</button>
        </form>
      </div>
    </div>

    <div id="transactionsSection" style="display:none" class="card">
      <h3>Transactions</h3>
      <table style="width:100%;border-collapse:collapse;color:#ddd">
        <thead><tr style="text-align:left"><th>User</th><th>Bot</th><th>Amount</th><th>Date</th></tr></thead>
        <tbody id="txBody">
          <tr><td>Kelvin</td><td>GoldBot</td><td>Ksh 800</td><td>22 Oct 2025</td></tr>
        </tbody>
      </table>
    </div>

    <div id="settingsSection" style="display:none" class="card">
      <h3>Settings</h3>
      <label>M-Pesa Number</label>
      <input id="mpesaNumber" value="0712345678" style="display:block;margin-top:6px;padding:8px;border-radius:6px;border:none;background:rgba(255,255,255,0.03);color:#fff">
      <div style="margin-top:10px"><button class="btn btn-primary" id="saveSettings">Save Changes</button></div>
    </div>
  </div>

<!-- Chart.js UMD (not module) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

<script>
/* Simple admin session check */
const ADMIN_SESSION_KEY = 'merrick_admin';
function ensureAdmin(){
  const s = localStorage.getItem(ADMIN_SESSION_KEY);
  if(!s){
    // Not logged in as admin
    location.href = 'index.html';
    return false;
  }
  try{
    const obj = JSON.parse(s);
    document.getElementById('adminEmailDisplay').textContent = obj.email || 'admin';
    return true;
  }catch(e){
    location.href = 'index.html';
    return false;
  }
}
if(!ensureAdmin()) throw new Error('Redirecting to login...');

/* Navigation */
const sections = {
  dashboard: document.getElementById('dashboardSection'),
  bots: document.getElementById('botsSection'),
  transactions: document.getElementById('transactionsSection'),
  settings: document.getElementById('settingsSection'),
};
function showSection(k){
  Object.values(sections).forEach(el => el && (el.style.display = 'none'));
  if(sections[k]) sections[k].style.display = 'block';
}
document.getElementById('navDashboard').addEventListener('click', ()=> showSection('dashboard'));
document.getElementById('navBots').addEventListener('click', ()=> showSection('bots'));
document.getElementById('navTx').addEventListener('click', ()=> showSection('transactions'));
document.getElementById('navSettings').addEventListener('click', ()=> showSection('settings'));
showSection('dashboard');

/* Logout */
document.getElementById('logoutBtn').addEventListener('click', ()=>{
  localStorage.removeItem(ADMIN_SESSION_KEY);
  alert('Logged out.');
  location.href = 'index.html';
});

/* Upload Bot placeholder */
document.getElementById('uploadBotBtn').addEventListener('click', ()=>{
  const name = document.getElementById('botName').value || 'Unnamed';
  const cat = document.getElementById('botCategory').value || 'General';
  const price = document.getElementById('botPrice').value || '0';
  const tbody = document.getElementById('txBody');
  // for admin demo: add a transaction row as placeholder
  const tr = document.createElement('tr');
  tr.innerHTML = `<td>Admin</td><td>${name}</td><td>Ksh ${price}</td><td>${new Date().toLocaleDateString()}</td>`;
  tbody.prepend(tr);
  alert('Bot uploaded (demo): ' + name);
});

/* Charts initialization (Chart.js UMD) */
const botCtx = document.getElementById('botCategoryChart').getContext('2d');
const botChart = new Chart(botCtx, {
  type: 'bar',
  data: {
    labels: ['Forex','Crypto','Stocks'],
    datasets: [{
      label: 'Bots count',
      data: [5,3,2],
      backgroundColor: ['#7c5cff','#ff6b6b','#1dd1a1']
    }]
  },
  options: { responsive:true, plugins:{legend:{display:false}} }
});

const txCtx = document.getElementById('transactionsChart').getContext('2d');
const txChart = new Chart(txCtx, {
  type:'bar',
  data:{
    labels:['Mon','Tue','Wed','Thu','Fri'],
    datasets:[{label:'Ksh',data:[500,800,300,900,400],backgroundColor:'#7c5cff'}]
  },
  options:{responsive:true,scales:{y:{beginAtZero:true}}}
});
</script>
</body>
</html>
