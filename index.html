<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Merrick Trade City â€” Login</title>
  <style>
    body {
      margin: 0;
      font-family: Inter, Arial, sans-serif;
      color: white;
      display: flex;
      min-height: 100vh;
      background: #0a1025;
    }
    .left {
      flex: 1;
      background: linear-gradient(to bottom, rgba(10,16,37,0.7), rgba(10,16,37,0.8)),
                  url('https://images.unsplash.com/photo-1605296867304-46d5465a13f1?auto=format&fit=crop&w=1470&q=80') center/cover no-repeat;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      text-align: center;
      font-size: 2rem;
      padding: 20px;
      animation: glow 2s ease-in-out infinite alternate;
      user-select: none;
    }
    @keyframes glow {
      from { text-shadow: 0 0 10px #7c5cff, 0 0 20px #7c5cff, 0 0 30px #7c5cff; }
      to { text-shadow: 0 0 20px #9b6cff, 0 0 40px #9b6cff, 0 0 60px #9b6cff; }
    }
    .right {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .form-container {
      background: rgba(255,255,255,0.05);
      padding: 40px;
      border-radius: 12px;
      width: 320px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      text-align: center;
      backdrop-filter: blur(10px);
    }
    input {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: none;
      outline: none;
      background: rgba(255,255,255,0.1);
      color: #fff;
    }
    button {
      background: linear-gradient(90deg,#7c5cff,#9b6cff);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
    }
    button:hover {
      opacity: 0.9;
      box-shadow: 0 0 10px #7c5cff;
    }
    .small {
      font-size: 13px;
      color: #bbb;
      margin-top: 10px;
    }
    .brand-line { font-size:1.2rem; margin-top:10px; cursor:pointer; }
    @media (max-width: 768px) {
      body { flex-direction: column; }
      .left { font-size: 1.5rem; padding: 40px 10px; }
      .right { width: 100%; padding: 20px; }
    }
  </style>
</head>
<body>
  <div class="left">
    <div>Merrick Trade City</div>
    <div class="brand-line" id="brandLine">Trade Smarter, Not Harder</div>
  </div>

  <div class="right">
    <div class="form-container" aria-live="polite">
      <h2>Admin Login</h2>
      <p class="small">Admin sign-in (only admin credentials grant access to admin panel).</p>
      <input type="email" id="emailInput" placeholder="Email" autocomplete="email">
      <input type="password" id="passwordInput" placeholder="Password" autocomplete="current-password">
      <button id="adminLoginBtn">Login as Admin</button>

      <hr style="border:none;height:1px;background:rgba(255,255,255,0.05);margin:8px 0">

      <h3 style="margin:0">User Login</h3>
      <p class="small">Or login with Deriv to use the user dashboard</p>
      <button id="derivLoginBtn">Login with Deriv</button>
    </div>
  </div>

  <!-- Firebase SDK (modular) -->
  <script type="module">
    // Firebase modular imports (browser)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      onAuthStateChanged,
      setPersistence,
      browserLocalPersistence,
      signOut
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

    // CONFIG - keep as you provided
    const firebaseConfig = {
      apiKey: "AIzaSyDD9yIS1kYVNJhVntodAUeeMAUOOtXwGdU",
      authDomain: "merrick-trade-city.firebaseapp.com",
      projectId: "merrick-trade-city",
      storageBucket: "merrick-trade-city.firebasestorage.app",
      messagingSenderId: "769684454569",
      appId: "1:769684454569:web:5f9ccf6629a0ea0db17db8"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Make auth available on window for debugging if needed
    window._firebaseAuth = auth;

    // Ensure persistence so admin doesn't get logged out unexpectedly
    await setPersistence(auth, browserLocalPersistence).catch(()=>{ /* ignore */ });

    // Admin credentials you confirmed (we still authenticate via Firebase)
    const ADMIN_EMAIL = "Saintmerrick66@gmail.com".toLowerCase();

    const adminLoginBtn = document.getElementById('adminLoginBtn');
    const derivLoginBtn = document.getElementById('derivLoginBtn');

    // Admin login flow
    adminLoginBtn.addEventListener('click', async () => {
      const email = (document.getElementById('emailInput').value || '').trim();
      const password = (document.getElementById('passwordInput').value || '').trim();
      if(!email || !password) return alert('Provide admin email & password.');

      try {
        const res = await signInWithEmailAndPassword(auth, email, password);
        // only allow admin email to continue
        if(email.toLowerCase() !== ADMIN_EMAIL) {
          alert('Unauthorized email for admin.');
          await signOut(auth);
          return;
        }
        // success -> go to admin page
        window.location.href = 'admin.html';
      } catch (err) {
        console.error('admin sign in', err);
        alert('Admin login failed: ' + (err.message || err));
      }
    });

    // Deriv OAuth for users
    const DERIV_APP_ID = '109286';
    const REDIRECT_URI = location.origin + '/user.html';

    derivLoginBtn.addEventListener('click', () => {
      const oauthUrl = 'https://oauth.deriv.com/oauth2/authorize'
        + '?app_id=' + encodeURIComponent(DERIV_APP_ID)
        + '&redirect_uri=' + encodeURIComponent(REDIRECT_URI)
        + '&response_type=token';
      // redirect user to Deriv for OAuth
      window.location.href = oauthUrl;
    });

    // Optional: quick double-click shortcut on the word "Trade" to go to admin (NOT required but left commented)
    // document.getElementById('brandLine').addEventListener('dblclick', () => { window.location.href = 'admin.html'; });

    // Keep user on index if not admin - but if already signed in as admin redirect immediately
    onAuthStateChanged(auth, (user) => {
      if(user && user.email && user.email.toLowerCase() === ADMIN_EMAIL) {
        // admin is still signed in -> redirect to admin page
        if(location.pathname.endsWith('index.html') || location.pathname.endsWith('/')) {
          window.location.href = 'admin.html';
        }
      }
    });

  </script>
</body>
</html>