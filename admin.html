<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Merrick Trade City â€” Admin Panel</title>
<link rel="icon" type="image/png" href="A_logo_for_Merrick_Trade_City_is_displayed_against.png.jpg">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{--bg:#0a1025;--accent:#7c5cff}
body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:#fff;display:flex;min-height:100vh}
.sidebar{width:220px;background:linear-gradient(180deg,#7c5cff,#0f0c29);padding:18px;display:flex;flex-direction:column;gap:12px}
.sidebar h2{margin:0;text-align:center}
.sidebar button{background:none;border:none;color:#fff;padding:8px;text-align:left;cursor:pointer;border-radius:6px;transition:0.2s}
.sidebar button:hover{background:rgba(255,255,255,0.1)}
.sidebar button.active{background:rgba(255,255,255,0.2)}
.main{flex:1;padding:18px;display:flex;flex-direction:column;gap:14px}
.summary{display:flex;gap:14px;flex-wrap:wrap}
.card{background:rgba(255,255,255,0.04);padding:12px;border-radius:10px;flex:1}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:8px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.1)}
.btn{padding:8px 10px;border-radius:8px;border:none;cursor:pointer}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#ddd}
.btn-primary{background:linear-gradient(90deg,#7c5cff,#ff6b6b);color:#fff}
input,textarea{padding:8px;border-radius:6px;border:none;background:rgba(255,255,255,0.05);color:#fff;width:100%}
</style>
</head>
<body>
  <div class="sidebar">
    <h2>Merrick Admin</h2>
    <button data-section="dashboard" class="active">Dashboard</button>
    <button data-section="users">Users</button>
    <button data-section="bots">Bots</button>
    <button data-section="transactions">Transactions</button>
    <button data-section="settings">Settings</button>
    <div style="margin-top:auto">
      <button id="logoutBtn" class="btn btn-ghost">Logout</button>
    </div>
  </div>

  <div class="main">
    <h1 style="margin:0;font-size:1.3rem">Admin Dashboard</h1>
    <div id="dashboardSection">
      <div class="summary">
        <div class="card"><h3>Total Users</h3><p id="totalUsers">0</p></div>
        <div class="card"><h3>Total Bots</h3><p id="totalBots">0</p></div>
        <div class="card"><h3>Total Balance</h3><p id="totalBalance">Ksh 0</p></div>
      </div>
      <canvas id="dashboardChart" style="max-width:600px;margin-top:20px;"></canvas>
    </div>

    <div id="usersSection" style="display:none" class="card">
      <h3>All Users & Activities</h3>
      <table class="table" id="userTable">
        <thead><tr><th>Name</th><th>Email</th><th>Balance</th><th>Last Activity</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="botsSection" style="display:none" class="card">
      <h3>Manage Bots</h3>
      <input type="file" id="botFile" accept=".xml" />
      <input type="text" id="botCategory" placeholder="Category (e.g. Forex)" />
      <input type="number" id="botPrice" placeholder="Price (Ksh)" />
      <button class="btn btn-primary" id="addBotBtn">Add Bot</button>
      <h4 style="margin-top:12px">Stored Bots</h4>
      <table class="table" id="botTable">
        <thead><tr><th>File</th><th>Category</th><th>Price</th><th>Action</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="transactionsSection" style="display:none" class="card">
      <h3>Transactions</h3>
      <table class="table" id="txTable">
        <thead><tr><th>User</th><th>Bot</th><th>Amount</th><th>Date</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="settingsSection" style="display:none" class="card">
      <h3>Settings</h3>
      <label>M-Pesa Number</label>
      <input id="mpesa" value="0712345678" />
      <label style="margin-top:8px;">Budget Address</label>
      <textarea id="wallet">Wallet Address 0x12345abcde...</textarea>
      <label style="margin-top:8px;">Enter Settings Password to Confirm</label>
      <input id="settingsPass" type="password" placeholder="Settings password" />
      <button class="btn btn-primary" id="saveSettingsBtn" style="margin-top:10px">Save Changes</button>
    </div>
  </div>

<script>
const sections = {
  dashboard: document.getElementById('dashboardSection'),
  users: document.getElementById('usersSection'),
  bots: document.getElementById('botsSection'),
  transactions: document.getElementById('transactionsSection'),
  settings: document.getElementById('settingsSection')
};

// Simple admin login check
if(!localStorage.getItem('merrick_admin')){
  alert('Admin not logged in.');
  location.href = 'index.html';
}

// Nav handling with active highlight
const sidebarBtns = document.querySelectorAll('.sidebar button[data-section]');
sidebarBtns.forEach(btn => {
  btn.onclick = () => {
    Object.values(sections).forEach(s => s.style.display='none');
    sections[btn.dataset.section].style.display='block';
    
    sidebarBtns.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
  };
});

// Logout
document.getElementById('logoutBtn').onclick = () => {
  localStorage.removeItem('merrick_admin');
  location.href='index.html';
};

/* -------- USERS & TRANSACTIONS -------- */
let users = [
  {name:'Kelvin',email:'kelvin@example.com',balance:1200,activity:'Bot Purchase'},
  {name:'Mary',email:'mary@demo.com',balance:750,activity:'Deposit'},
  {name:'Derrick',email:'derrick@bot.com',balance:0,activity:'Trial Bot'}
];

let transactions = JSON.parse(localStorage.getItem('transactions')||'[]');

function renderUsers(){
  const body = document.querySelector('#userTable tbody');
  body.innerHTML = '';
  let totalBalance = 0;
  users.forEach(u => {
    totalBalance += u.balance;
    const tr = document.createElement('tr');
    tr.innerHTML = <td>${u.name}</td><td>${u.email}</td><td>Ksh ${u.balance}</td><td>${u.activity}</td>;
    body.appendChild(tr);
  });
  document.getElementById('totalUsers').textContent = users.length;
  document.getElementById('totalBalance').textContent = Ksh ${totalBalance};
  updateChart();
}

function renderTransactions(){
  const body = document.querySelector('#txTable tbody');
  body.innerHTML = '';
  transactions.forEach(tx=>{
    const tr = document.createElement('tr');
    tr.innerHTML = <td>${tx.user}</td><td>${tx.bot}</td><td>Ksh ${tx.amount}</td><td>${tx.date}</td>;
    body.appendChild(tr);
  });
}

renderUsers();
renderTransactions();

/* -------- BOTS MANAGER -------- */
const botTable = document.querySelector('#botTable tbody');
const bots = JSON.parse(localStorage.getItem('adminBots') || '[]');

function renderBots(){
  botTable.innerHTML = '';
  bots.forEach((b, i) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${b.file}</td>
      <td>${b.category}</td>
      <td>Ksh ${b.price}</td>
      <td><button class="btn-ghost" onclick="removeBot(${i})">Remove</button></td>
    `;
    botTable.appendChild(tr);
  });
  document.getElementById('totalBots').textContent = bots.length;
  updateChart();
}

function removeBot(i){
  bots.splice(i,1);
  localStorage.setItem('adminBots', JSON.stringify(bots));
  renderBots();
}

document.getElementById('addBotBtn').onclick = () => {
  const f = document.getElementById('botFile').files[0];
  const cat = document.getElementById('botCategory').value.trim();
  const price = parseInt(document.getElementById('botPrice').value.trim()) || 0;
  if(!f) return alert('Select a .xml file.');
  
  const bot = {file: f.name, category: cat || 'General', price};
  bots.push(bot);
  localStorage.setItem('adminBots', JSON.stringify(bots));
  
  // Simulate a purchase by random user
  const user = users[Math.floor(Math.random()*users.length)];
  user.balance += price;
  user.activity = Purchased ${f.name};
  transactions.push({user: user.name, bot: f.name, amount: price, date: new Date().toLocaleDateString()});
  localStorage.setItem('transactions', JSON.stringify(transactions));
  
  renderBots();
  renderUsers();
  renderTransactions();
  alert('Bot added & transaction logged successfully!');
};
renderBots();

/* -------- SETTINGS -------- */
document.getElementById('saveSettingsBtn').onclick = () => {
  const pass = document.getElementById('settingsPass').value;
  if(pass !== '0758026285'){ 
    alert('Incorrect settings password.');
    return;
  }
  const mpesa = document.getElementById('mpesa').value;
  const wallet = document.getElementById('wallet').value;
  localStorage.setItem('adminSettings', JSON.stringify({mpesa, wallet}));
  alert('Settings saved successfully!');
};

const saved = JSON.parse(localStorage.getItem('adminSettings') || '{}');
if(saved.mpesa) document.getElementById('mpesa').value = saved.mpesa;
if(saved.wallet) document.getElementById('wallet').value = saved.wallet;

/* -------- REAL-TIME BAR CHART -------- */
const ctx = document.getElementById('dashboardChart').getContext('2d');
const dashboardChart = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: ['Users','Bots','Total Balance'],
    datasets:[{
      label:'Dashboard Overview',
      data: [0,0,0],
      backgroundColor:['#7c5cff','#ff6b6b','#1dd1a1']
    }]
  },
  options:{responsive:true,plugins:{legend:{display:false}}}
});

function updateChart(){
  const totalBalance = users.reduce((sum,u)=>sum+u.balance,0);
  dashboardChart.data.datasets[0].data = [users.length, bots.length, totalBalance];
  dashboardChart.update();
}

updateChart();
</script>
</body>
</html>
