<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Merrick Trade City â€” Admin Panel</title>
<link rel="icon" type="image/png" href="A_logo_for_Merrick_Trade_City_is_displayed_against.png.jpg">

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{--bg:#0a1025;--accent:#7c5cff}
body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:#fff;display:flex;min-height:100vh}
.sidebar{width:220px;background:linear-gradient(180deg,#7c5cff,#0f0c29);padding:18px;display:flex;flex-direction:column;gap:12px}
.sidebar h2{margin:0;text-align:center}
.sidebar button{background:none;border:none;color:#fff;padding:8px;text-align:left;cursor:pointer;border-radius:6px}
.sidebar button:hover{background:rgba(255,255,255,0.1)}
.main{flex:1;padding:18px;display:flex;flex-direction:column;gap:14px}
.summary{display:flex;gap:14px;flex-wrap:wrap}
.card{background:rgba(255,255,255,0.04);padding:12px;border-radius:10px;flex:1}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:8px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.1)}
.btn{padding:8px 10px;border-radius:8px;border:none;cursor:pointer}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#ddd}
.btn-primary{background:linear-gradient(90deg,#7c5cff,#ff6b6b);color:#fff}
input,textarea{padding:8px;border-radius:6px;border:none;background:rgba(255,255,255,0.05);color:#fff;width:100%}
.withdraw-section{margin-top:14px;}
</style>
</head>
<body>
  <div class="sidebar">
    <h2>Merrick Admin</h2>
    <button data-section="dashboard">Dashboard</button>
    <button data-section="users">Users</button>
    <button data-section="bots">Bots</button>
    <button data-section="transactions">Transactions</button>
    <button data-section="settings">Settings</button>
    <div style="margin-top:auto">
      <button id="logoutBtn" class="btn btn-ghost">Logout</button>
    </div>
  </div>

  <div class="main">
    <h1 style="margin:0;font-size:1.3rem">Admin Dashboard</h1>

    <!-- Dashboard Section -->
    <div id="dashboardSection">
      <div class="summary">
        <div class="card"><h3>Total Users</h3><p id="totalUsers">0</p></div>
        <div class="card"><h3>Total Bots</h3><p id="totalBots">0</p></div>
        <div class="card"><h3>Total Balance</h3><p id="totalBalance">Ksh 0</p></div>
      </div>
      <div class="card">
        <h3>Transactions Chart</h3>
        <canvas id="txChart" height="100"></canvas>
      </div>
    </div>

    <!-- Users Section -->
    <div id="usersSection" style="display:none" class="card">
      <h3>All Users & Activities</h3>
      <table class="table" id="userTable">
        <thead><tr><th>Name</th><th>Email</th><th>Balance</th><th>Last Activity</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Bots Section -->
    <div id="botsSection" style="display:none" class="card">
      <h3>Manage Bots</h3>
      <input type="file" id="botFile" accept=".xml" />
      <input type="text" id="botCategory" placeholder="Category (e.g. Forex)" />
      <input type="number" id="botPrice" placeholder="Price (Ksh)" />
      <button class="btn btn-primary" id="addBotBtn">Add Bot</button>
      <h4 style="margin-top:12px">Stored Bots</h4>
      <table class="table" id="botTable">
        <thead><tr><th>File</th><th>Category</th><th>Price</th><th>Action</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Transactions Section -->
    <div id="transactionsSection" style="display:none" class="card">
      <h3>Transactions</h3>
      <table class="table" id="txTable">
        <thead><tr><th>User</th><th>Bot</th><th>Amount</th><th>Date</th></tr></thead>
        <tbody></tbody>
      </table>
      <div class="withdraw-section">
        <h3>Withdraw Funds to M-Pesa</h3>
        <input id="withdrawUser" placeholder="User Email" />
        <input type="number" id="withdrawAmount" placeholder="Amount (Ksh)" />
        <button class="btn btn-primary" id="withdrawBtn">Withdraw</button>
      </div>
    </div>

    <!-- Settings Section -->
    <div id="settingsSection" style="display:none" class="card">
      <h3>Settings</h3>
      <label>M-Pesa Number</label>
      <input id="mpesa" value="" />
      <label style="margin-top:8px;">Wallet Address</label>
      <textarea id="wallet"></textarea>
      <label style="margin-top:8px;">Enter Settings Password to Confirm</label>
      <input id="settingsPass" type="password" placeholder="Settings password" />
      <button class="btn btn-primary" id="saveSettingsBtn" style="margin-top:10px">Save Changes</button>
    </div>
  </div>

<script>
// Section Navigation
const sections = {
  dashboard: document.getElementById('dashboardSection'),
  users: document.getElementById('usersSection'),
  bots: document.getElementById('botsSection'),
  transactions: document.getElementById('transactionsSection'),
  settings: document.getElementById('settingsSection')
};
document.querySelectorAll('.sidebar button[data-section]').forEach(btn=>{
  btn.onclick=()=>{Object.values(sections).forEach(s=>s.style.display='none');sections[btn.dataset.section].style.display='block';};
});

// Logout
document.getElementById('logoutBtn').onclick=()=>{
  localStorage.removeItem('merrick_admin');
  location.href='index.html';
};

// Fetch live data from API (replace URLs with real endpoints)
async function fetchUsers(){
  const res = await fetch('/api/users');
  return res.json();
}
async function fetchBots(){
  const res = await fetch('/api/bots');
  return res.json();
}
async function fetchTransactions(){
  const res = await fetch('/api/transactions');
  return res.json();
}

// Render Users
async function renderUsers(){
  const users = await fetchUsers();
  const tbody = document.querySelector('#userTable tbody');
  tbody.innerHTML = '';
  users.forEach(u=>{
    const tr = document.createElement('tr');
   tr.innerHTML = <td>${u.name}</td><td>${u.email}</td><td>Ksh ${u.balance}</td><td>${u.lastActivity}</td>;
    tbody.appendChild(tr);
  });
  document.getElementById('totalUsers').textContent = users.length;
}

// Render Bots
async function renderBots(){
  const bots = await fetchBots();
  const tbody = document.querySelector('#botTable tbody');
  tbody.innerHTML = '';
  bots.forEach((b,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = <td>${b.file}</td><td>${b.category}</td><td>Ksh ${b.price}</td><td><button class='btn-ghost' onclick='removeBot("${b.id}")'>Remove</button></td>;
    tbody.appendChild(tr);
  });
  document.getElementById('totalBots').textContent = bots.length;
}
window.removeBot = async (id) => {
  await fetch(/api/bots/${id},{method:'DELETE'});
  renderBots();
}

// Render Transactions
async function renderTransactions(){
  const txs = await fetchTransactions();
  const tbody = document.querySelector('#txTable tbody');
  tbody.innerHTML = '';
  let total = 0;
  txs.forEach(t=>{
    total += t.amount;
    const tr = document.createElement('tr');
    tr.innerHTML = <td>${t.user}</td><td>${t.bot}</td><td>Ksh ${t.amount}</td><td>${t.date}</td>;
    tbody.appendChild(tr);
  });
  document.getElementById('totalBalance').textContent = Ksh ${total};
  updateChart(txs);
}

// Withdraw Funds
document.getElementById('withdrawBtn').onclick = async ()=>{
  const email = document.getElementById('withdrawUser').value;
  const amount = Number(document.getElementById('withdrawAmount').value);
  if(!email || !amount) return alert('Enter user and amount');
  const res = await fetch('/api/withdraw',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({email,amount})
  });
  const data = await res.json();
  alert(data.message);
  renderUsers();
  renderTransactions();
}

// Chart.js for live transactions
let txChart;
function updateChart(txs){
  const labels = txs.map(t=>t.date);
  const amounts = txs.map(t=>t.amount);
  if(txChart) txChart.destroy();
  const ctx = document.getElementById('txChart').getContext('2d');
  txChart = new Chart(ctx,{
    type:'bar',
    data:{labels, datasets:[{label:'Transaction Amount', data:amounts, backgroundColor:'#7c5cff'}]},
    options:{responsive:true,plugins:{legend:{display:false}}}
  });
}

// Initial render
renderUsers();
renderBots();
renderTransactions();

// Save Settings
document.getElementById('saveSettingsBtn').onclick=async ()=>{
  const pass=document.getElementById('settingsPass').value;
  if(pass!=='0758026285'){alert('Incorrect settings password');return;}
  const mpesa=document.getElementById('mpesa').value;
  const wallet=document.getElementById('wallet').value;
  await fetch('/api/settings',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mpesa,wallet})});
  alert('Settings saved!');
};

// Periodic live update every 10s
setInterval(()=>{renderUsers();renderBots();renderTransactions();},10000);
</script>
</body>
</html>

