<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Merrick Trade City — User Panel</title>
<link rel="icon" type="image/png" href="A_logo_for_Merrick_Trade_City_is_displayed_against.png.jpg">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
@import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap");
:root{--bg:#0c0f1f;--accent:#7c5cff;--accent2:#6a4bff;--muted:#bfbfcf}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Poppins',sans-serif}
html,body{height:100%}
body{display:flex;min-height:100vh;background:radial-gradient(circle at top,var(--bg),#05060d);color:#fff}
.loading-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(6,8,20,0.9), rgba(6,8,20,0.95));z-index:9999;flex-direction:column;transition:opacity .5s,visibility .5s}
.loading-hidden{opacity:0;visibility:hidden;pointer-events:none}
.brand-glow{font-size:36px;font-weight:800;background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;color:transparent}
.loading-sub{margin-top:12px;color:var(--muted)}
.sidebar{width:260px;padding:22px;background:linear-gradient(180deg, rgba(124,92,255,0.92), rgba(15,12,41,0.95));display:flex;flex-direction:column;justify-content:space-between;border-right:1px solid rgba(255,255,255,0.06)}
.profile-card{display:flex;gap:12px;align-items:center;background:rgba(255,255,255,0.03);padding:12px;border-radius:12px}
.profile-card img{width:64px;height:64px;border-radius:50%;object-fit:cover;cursor:pointer}
.menu{display:flex;flex-direction:column;gap:6px}
.menu button{background:none;border:none;color:#fff;padding:12px;border-radius:10px;text-align:left;cursor:pointer;font-weight:600}
.menu button.active{background:linear-gradient(90deg,var(--accent),var(--accent2))}
.main{flex:1;padding:18px;display:flex;flex-direction:column;gap:16px;overflow:auto}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:12px}
.chart-box{height:420px;border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
.bots-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:8px}
.bot-card{background:rgba(255,255,255,0.03);padding:12px;border-radius:12px;text-align:center}
.input{width:100%;padding:10px;border-radius:8px;border:none;background:rgba(255,255,255,0.03);color:#fff}
footer{margin-top:10px;text-align:center;color:var(--muted)}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center}
.modal-content{background:#0f0c29;padding:18px;border-radius:12px;width:94%;max-width:520px}
.btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
.btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff}
@media(max-width:980px){.sidebar{width:100%;flex-direction:row;overflow:auto}.menu{flex-direction:row}}
</style>
</head>
<body><div id="loadingOverlay" class="loading-overlay" role="status" aria-live="polite">
  <div class="brand-glow">Merrick Trade City</div>
  <div class="loading-sub" id="loadingSub">Connecting… please wait</div>
</div><div class="sidebar" role="navigation">
  <div>
    <h2>User Panel</h2>
    <div class="profile-card card">
      <img id="profilePic" src="A_logo_for_Merrick_Trade_City_is_displayed_against.png.jpg" alt="avatar" onclick="onChangeProfilePic()" />
      <div>
        <div id="userName">—</div>
        <small id="userBalance">Balance: —</small>
        <small id="userEmail">—</small>
      </div>
    </div>
    <div class="menu" id="menu">
      <button data-section="dashboard" class="active">Dashboard</button>
      <button data-section="bots">Bots</button>
      <button data-section="charts">Charts</button>
    </div>
  </div>
</div><div class="main">
  <div class="welcome card">
    <div style="display:flex;gap:12px;align-items:center">
      <img src="A_logo_for_Merrick_Trade_City_is_displayed_against.png.jpg" style="width:48px;height:48px;border-radius:10px" alt="logo">
      <div>
        <div style="font-weight:700">Welcome back, <span id="displayName">User</span></div>
        <div class="small-muted">Trade live with Deriv inside Merrick Trade City</div>
      </div>
    </div>
  </div>  <section id="dashboardSection" class="card">
    <h3>TradingView Chart</h3>
    <div class="chart-box" id="tvChartWrap"></div>
  </section>  <section id="botsSection" style="display:none" class="card">
    <h3>Your Bots</h3>
    <div class="bots-grid" id="botsContainer"></div>
  </section>  <footer><small class="small-muted">© 2025 Merrick Trade City — All rights reserved.</small></footer>
</div><script>
/* ======== Basic UI and Menu ======== */
qsa = sel=>Array.from(document.querySelectorAll(sel));
qs = sel=>document.querySelector(sel);
qsa('.menu button').forEach(btn=>{
  btn.addEventListener('click', ()=> {
    qsa('.menu button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const sections={'dashboard':'dashboardSection','bots':'botsSection','charts':'dashboardSection'};
    Object.values(sections).forEach(id=>{const el=qs('#'+id); if(el) el.style.display='none';});
    const showId = sections[btn.dataset.section];
    if(showId) qs('#'+showId).style.display='block';
  });
});

/* ======== Deriv WS ======== */
const DERIV_APP_ID='109286';
let derivWS=null;
function connectDeriv(){
  const token=prompt('Login to Deriv — paste your token (for demo you can use test token):');
  if(!token) return alert('No token entered');
  derivWS=new WebSocket('wss://ws.binaryws.com/websockets/v3?app_id='+DERIV_APP_ID);
  derivWS.onopen=()=>{ derivWS.send(JSON.stringify({authorize:token})); alert('Connected!'); initUser(); };
  derivWS.onmessage=(evt)=>{const d=JSON.parse(evt.data); if(d.authorize){if(d.authorize.balance){qs('#userBalance').textContent='Balance: '+d.authorize.balance;}}};
  derivWS.onerror=e=>console.error('WS error',e);
  derivWS.onclose=()=>console.log('Deriv WS closed');
}
function initUser(){
  qs('#displayName').textContent='DerivUser';
  qs('#userEmail').textContent='user@deriv.com';
  qs('#userBalance').textContent='Balance: 1000';
}
connectDeriv();

/* ======== TradingView ======== */
function embedTradingView(targetId,symbol='OANDA:XAUUSD'){
  const w=qs('#'+targetId);
  if(!w) return;
  const frame=document.createElement('iframe');
  frame.style.width='100%';
  frame.style.height='100%';
  frame.style.border=0;
  frame.src='https://s.tradingview.com/widgetembed/?frameElementId='+encodeURIComponent(targetId)+'&symbol='+encodeURIComponent(symbol)+'&interval=60&hidesidetoolbar=1&theme=dark';
  w.innerHTML=''; w.appendChild(frame);
}
embedTradingView('tvChartWrap','OANDA:XAUUSD');

/* ======== Live Bot System ======== */
const botsContainer = document.getElementById('botsContainer');
let activeBots = [];

function createBot(symbol,direction,stake,duration){
  const botId='bot-'+Date.now();
  const bot={id:botId,symbol,direction,stake,duration,interval:null,log:[]};
  const botCard=document.createElement('div');
  botCard.className='bot-card card';
  botCard.id=botId;
  botCard.innerHTML=`
    <h4>Bot: ${symbol}</h4>
    <div>Direction: ${direction}</div>
    <div>Stake: ${stake} USD</div>
    <div>Duration: ${duration}m</div>
    <div id="${botId}-log" style="margin-top:6px;max-height:120px;overflow:auto;background:rgba(255,255,255,0.05);padding:4px;border-radius:6px;font-size:12px"></div>
    <button id="${botId}-start" class="btn btn-primary" style="margin-top:6px">Start</button>
    <button id="${botId}-stop" class="btn" style="margin-top:6px">Stop</button>
  `;
  botsContainer.appendChild(botCard);

  document.getElementById(botId+'-start').addEventListener('click',()=>{
    if(bot.interval) return alert('Bot already running');
    bot.interval=setInterval(()=>executeBotTrade(bot),duration*60*1000);
    executeBotTrade(bot);
});

document.getElementById(botId+'-stop').addEventListener('click',()=>{
clearInterval(bot.interval);
bot.interval=null;
appendBotLog(bot,'Bot stopped.');
});

activeBots.push(bot);
}

function appendBotLog(bot,msg){
bot.log.push(msg);
const logEl=qs('#'+bot.id+'-log');
if(logEl){
const entry=document.createElement('div'); entry.textContent=msg;
logEl.appendChild(entry);
logEl.scrollTop=logEl.scrollHeight;
}
}

function executeBotTrade(bot){
if(!derivWS || derivWS.readyState!==1){
appendBotLog(bot,'Deriv WS not connected.');
return;
}

const tradeRequest={
buy:1,
price:bot.stake,
parameters:{
amount:bot.stake,
basis:'stake',
contract_type:(bot.direction.toUpperCase()=='CALL')?'CALL':'PUT',
currency:'USD',
duration:bot.duration,
duration_unit:'m',
symbol:bot.symbol
}
};

derivWS.send(JSON.stringify(tradeRequest));
appendBotLog(bot,'Placed '+bot.direction+' trade on '+bot.symbol+' with $'+bot.stake);
}

/* ======== Misc UI ======== */
function onChangeProfilePic(){
const newPic=prompt('Enter image URL for profile:');
if(newPic) qs('#profilePic').src=newPic;
}

/* ======== Loading Overlay ======== */
window.addEventListener('load',()=>{
setTimeout(()=>{
qs('#loadingOverlay').classList.add('loading-hidden');
},1000);
});
</script>

</body>
</html>
